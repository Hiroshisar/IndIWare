<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="IndiWare.MainPage">
    <Grid>
        <ScrollView>
            <VerticalStackLayout Padding="20">
                <Button Text="Index"
                        Clicked="OnIndexFilesClicked"
                        x:Name="IndexButton"
                        HorizontalOptions="FillAndExpand"
                        Grid.Column="0"
                        CornerRadius="8"
                        HeightRequest="60"
                        Margin="10"/>

                <Grid Margin="5" ColumnSpacing="10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="200" />
                    </Grid.ColumnDefinitions>

                    <!-- SEARCH BAR -->
                    <Entry x:Name="SearchEntry"
                        Placeholder="Text to search..."
                        Grid.Column="0" />

                    <!-- SEARCH BUTTON -->
                    <Button Text="Search"
                        Clicked="OnSearchFileClicked"
                        Grid.Column="1" />
                </Grid>

                <CollectionView x:Name="ResultsView"
                ItemsSource="{x:Binding Results}">
                    <CollectionView.ItemsLayout>
                        <LinearItemsLayout Orientation="Vertical" ItemSpacing="5" />
                    </CollectionView.ItemsLayout>

                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Grid ColumnSpacing="10">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="200" />
                                </Grid.ColumnDefinitions>

                                <!-- CARD -->
                                <Border Grid.Column="0"
                                        Stroke="#A88CFF"
                                        StrokeShape="RoundRectangle 12"
                                        StrokeThickness="1.5"
                                        BackgroundColor="White"
                                        Padding="12"
                                        HorizontalOptions="FillAndExpand">

                                    <Border.Shadow>
                                        <Shadow Brush="Black"
                                                Opacity="0.15"
                                                Offset="0,3"
                                                Radius="6"/>
                                    </Border.Shadow>

                                    <VerticalStackLayout Spacing="6">
                                        <!-- FILE NAME -->
                                        <Label Text="{Binding FileName}"
                                               FontAttributes="Bold"
                                               FontSize="16"
                                               TextColor="#4B3FA6"/>

                                        <!-- FILE PATH -->
                                        <Label Text="{Binding FilePath}"
                                               FontSize="12"
                                               TextColor="#555"/>

                                        <!-- TAGS ROW -->
                                        <HorizontalStackLayout Spacing="8">
                                            <!-- EXTENSION -->
                                            <Frame Padding="4,2"
                                                   BackgroundColor="#EEE9FF"
                                                   BorderColor="#A88CFF"
                                                   CornerRadius="6"
                                                   HasShadow="False">
                                                <Label Text="{Binding FileExtension}"
                                                       FontSize="12"
                                                       TextColor="#4B3FA6"/>
                                            </Frame>

                                            <!-- SIZE -->
                                            <Frame Padding="4,2"
                                                   BackgroundColor="#EEE9FF"
                                                   BorderColor="#A88CFF"
                                                   CornerRadius="6"
                                                   HasShadow="False">
                                                <Label Text="{Binding FileSizeReadable}"
                                                       FontSize="12"
                                                       TextColor="#4B3FA6"/>
                                            </Frame>
                                        </HorizontalStackLayout>

                                        <!-- DATES -->
                                        <Grid ColumnSpacing="10" RowSpacing="4">
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                            </Grid.RowDefinitions>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>

                                            <Label Grid.Row="0" Grid.Column="0"
                                                   Text="Created:"
                                                   FontAttributes="Bold"
                                                   FontSize="12"
                                                   TextColor="#444"/>
                                            <Label Grid.Row="0" Grid.Column="1"
                                                   Text="{Binding Created}"
                                                   FontSize="12"
                                                   TextColor="#444"/>

                                            <Label Grid.Row="1" Grid.Column="0"
                                                   Text="Modified:"
                                                   FontAttributes="Bold"
                                                   FontSize="12"
                                                   TextColor="#444"/>
                                            <Label Grid.Row="1" Grid.Column="1"
                                                   Text="{Binding LastModified}"
                                                   FontSize="12"
                                                   TextColor="#444"/>
                                        </Grid>
                                    </VerticalStackLayout>
                                </Border>

                                <!-- BUTTON -->
                                <Button Grid.Column="1"
                                        Text="Open"
                                        Clicked="OnViewFileClicked"
                                        CommandParameter="{Binding .}"
                                        VerticalOptions="FillAndExpand"
                                        HorizontalOptions="FillAndExpand" />
                            </Grid>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>

                    <!-- FOOTER WITH BUTTON -->
                    <CollectionView.Footer>
                        <Grid Padding="10"
                              HorizontalOptions="FillAndExpand"
                              ColumnDefinitions="*">

                            <Button Text="Load more"
                                    Clicked="OnLoadMoreClicked"
                                    x:Name="LoadMoreButton"
                                    IsVisible="false"
                                    HorizontalOptions="FillAndExpand"
                                    Grid.Column="0"
                                    CornerRadius="8"
                                    HeightRequest="45"/>

                        </Grid>
                    </CollectionView.Footer>
                </CollectionView>
            </VerticalStackLayout>
        </ScrollView>

        <!-- LOADING OVERLAY -->
        <Grid x:Name="LoadingOverlay"
              BackgroundColor="#80000000"
              IsVisible="False"
              InputTransparent="False">
            <ActivityIndicator IsRunning="True"
                               VerticalOptions="Center"
                               HorizontalOptions="Center"
                               Color="White"
                               WidthRequest="50"
                               HeightRequest="50" />
        </Grid>
    </Grid>

</ContentPage>